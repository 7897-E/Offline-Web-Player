<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Music Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            background: #121212;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        
        header {
            background: #000000;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #2a2a2a;
            position: relative;
            transition: all 0.3s ease;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            color: #ffffff;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .tagline {
            color: #a0a0a0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .theme-toggle {
            position: absolute;
            right: 20px;
            top: 20px;
            background: #1c1c1c;
            border: none;
            color: #a0a0a0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            background: #2a2a2a;
            color: #fff;
        }
        
        .player-container {
            padding: 25px;
            display: flex;
            gap: 30px;
        }
        
        .now-playing {
            flex: 1;
            text-align: center;
            position: relative;
        }
        
        .album-art-container {
            position: relative;
            width: 240px;
            height: 240px;
            margin: 0 auto 20px;
        }
        
        .circular-progress {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(#1db954 0%, transparent 0%);
            mask: radial-gradient(farthest-side, transparent calc(100% - 5px), #fff 0);
            -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 5px), #fff 0);
            transition: background 0.3s ease;
        }
        
        .circular-progress.playing {
            animation: rotateProgress 15s linear infinite;
        }
        
        @keyframes rotateProgress {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .album-art {
            position: absolute;
            top: 10px;
            left: 10px;
            width: calc(100% - 20px);
            height: calc(100% - 20px);
            border-radius: 50%;
            background: linear-gradient(45deg, #2c2c2c, #000000);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 5px solid #2a2a2a;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
            transition: all 0.3s ease;
        }
        
        .album-art i {
            font-size: 5rem;
            color: #404040;
            transition: all 0.3s ease;
        }
        
        .album-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }
        
        .track-info {
            font-size: 1.4rem;
            margin-bottom: 5px;
            color: #ffffff;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }
        
        .artist {
            color: #a0a0a0;
            font-size: 1.1rem;
            margin-bottom: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }
        
        .progress-container {
            background: #2a2a2a;
            border-radius: 5px;
            height: 6px;
            margin: 20px 0;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .progress {
            background: #f5f5f5;
            border-radius: 5px;
            height: 100%;
            width: 0%;
            transition: width 0.1s ease;
            position: relative;
        }
        
        .progress-handle {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #f5f5f5;
            position: absolute;
            top: 50%;
            right: -7px;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .progress-container:hover .progress-handle {
            opacity: 1;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #a0a0a0;
            transition: all 0.3s ease;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .btn {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background: #1c1c1c;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
        }
        
        .btn:hover {
            background: #2a2a2a;
            transform: scale(1.1);
        }
        
        .btn.active {
            color: #1db954;
            background: #2a2a2a;
        }
        
        .btn-play {
            background: #f5f5f5;
            color: #121212;
            font-size: 1.8rem;
            width: 60px;
            height: 60px;
            transition: all 0.3s ease;
        }
        
        .btn-play:hover {
            background: #ffffff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .volume-slider {
            width: 100px;
            -webkit-appearance: none;
            height: 4px;
            border-radius: 5px;
            background: #2a2a2a;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #f5f5f5;
            cursor: pointer;
        }
        
        .playback-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        /* Speed popup styling */
        .speed-popup {
            position: absolute;
            bottom: 80px;
            right: 0;
            background: #1c1c1c;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: none;
            flex-direction: column;
            gap: 10px;
            width: 150px;
            transition: all 0.3s ease;
        }
        
        .speed-popup.show {
            display: flex;
        }
        
        .speed-option {
            background: #2a2a2a;
            border: none;
            color: #e0e0e0;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .speed-option:hover {
            background: #3a3a3a;
        }
        
        .speed-option.active {
            background: #1db954;
            color: #fff;
        }
        
        .playlist-section {
            flex: 1;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            max-height: 450px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #2a2a2a;
            transition: all 0.3s ease;
        }
        
        .playlist-header h2 {
            color: #ffffff;
            font-size: 1.3rem;
            transition: all 0.3s ease;
        }
        
        .search-box {
            background: #121212;
            border: 1px solid #2a2a2a;
            border-radius: 20px;
            padding: 8px 15px;
            color: #e0e0e0;
            width: 180px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #f5f5f5;
        }
        
        .track-list {
            list-style: none;
            overflow-y: auto;
            flex: 1;
            border-radius: 8px;
            background: #121212;
            padding: 10px;
            transition: all 0.3s ease;
        }
        
        /* Scrollbar styling */
        .track-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .track-list::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 4px;
        }
        
        .track-list::-webkit-scrollbar-thumb {
            background: #2a2a2a;
            border-radius: 4px;
        }
        
        .track-list::-webkit-scrollbar-thumb:hover {
            background: #3a3a3a;
        }
        
        .track-item {
            padding: 12px 15px;
            border-bottom: 1px solid #2a2a2a;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            border-radius: 5px;
        }
        
        .track-item:last-child {
            border-bottom: none;
        }
        
        .track-item:hover {
            background: #1c1c1c;
        }
        
        .track-item.active {
            background: #2a2a2a;
            color: #ffffff;
        }
        
        .track-number {
            font-size: 0.9rem;
            color: #a0a0a0;
            width: 25px;
            text-align: right;
        }
        
        .track-details {
            flex: 1;
        }
        
        .track-title {
            display: block;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .track-artist {
            font-size: 0.8rem;
            color: #888;
        }
        
        .track-duration {
            color: #a0a0a0;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            background: #000;
            color: #666;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #1db954;
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .player-container {
                flex-direction: column;
            }
            
            .playlist-section {
                max-height: 300px;
            }
            
            .speed-popup {
                right: 50%;
                transform: translateX(50%);
            }
        }
        
        @media (max-width: 600px) {
            .container {
                border-radius: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .album-art-container {
                width: 200px;
                height: 200px;
            }
            
            .album-art {
                top: 8px;
                left: 8px;
                width: calc(100% - 16px);
                height: calc(100% - 16px);
            }
            
            .track-info {
                font-size: 1.2rem;
            }
            
            .controls {
                gap: 10px;
            }
            
            .btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .btn-play {
                width: 55px;
                height: 55px;
                font-size: 1.5rem;
            }
            
            .playlist-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .search-box {
                width: 100%;
            }
            
            .theme-toggle {
                position: relative;
                right: 0;
                top: 0;
                margin-top: 10px;
            }
        }
        
        /* Light theme styles */
        .light-theme {
            background: linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%);
            color: #333;
        }
        
        .light-theme .container {
            background: #f9f9f9;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .light-theme header {
            background: #e0e0e0;
            border-bottom: 1px solid #d0d0d0;
        }
        
        .light-theme h1 {
            color: #333;
        }
        
        .light-theme .tagline {
            color: #666;
        }
        
        .light-theme .album-art {
            background: linear-gradient(45deg, #d0d0d0, #e0e0e0);
            border: 5px solid #d0d0d0;
        }
        
        .light-theme .album-art i {
            color: #a0a0a0;
        }
        
        .light-theme .track-info {
            color: #333;
        }
        
        .light-theme .artist {
            color: #666;
        }
        
        .light-theme .progress-container {
            background: #d0d0d0;
        }
        
        .light-theme .progress {
            background: #333;
        }
        
        .light-theme .progress-handle {
            background: #333;
        }
        
        .light-theme .time-display {
            color: #666;
        }
        
        .light-theme .btn {
            background: #e0e0e0;
            color: #333;
        }
        
        .light-theme .btn:hover {
            background: #d0d0d0;
        }
        
        .light-theme .btn.active {
            color: #1db954;
            background: #d0d0d0;
        }
        
        .light-theme .btn-play {
            background: #333;
            color: #f9f9f9;
        }
        
        .light-theme .btn-play:hover {
            background: #555;
        }
        
        .light-theme .volume-slider {
            background: #d0d0d0;
        }
        
        .light-theme .volume-slider::-webkit-slider-thumb {
            background: #333;
        }
        
        .light-theme .playlist-section {
            background: #e9e9e9;
        }
        
        .light-theme .playlist-header {
            border-bottom: 1px solid #d0d0d0;
        }
        
        .light-theme .playlist-header h2 {
            color: #333;
        }
        
        .light-theme .search-box {
            background: #f9f9f9;
            border: 1px solid #d0d0d0;
            color: #333;
        }
        
        .light-theme .search-box:focus {
            border-color: #333;
        }
        
        .light-theme .track-list {
            background: #f9f9f9;
        }
        
        .light-theme .track-item {
            border-bottom: 1px solid #e0e0e0;
        }
        
        .light-theme .track-item:hover {
            background: #e9e9e9;
        }
        
        .light-theme .track-item.active {
            background: #d0d0d0;
            color: #333;
        }
        
        .light-theme .track-number {
            color: #666;
        }
        
        .light-theme .track-artist {
            color: #666;
        }
        
        .light-theme .track-duration {
            color: #666;
        }
        
        .light-theme footer {
            background: #e0e0e0;
            color: #666;
        }
        
        .light-theme .speed-popup {
            background: #e0e0e0;
        }
        
        .light-theme .speed-option {
            background: #d0d0d0;
            color: #333;
        }
        
        .light-theme .speed-option:hover {
            background: #c0c0c0;
        }
        
        .light-theme .speed-option.active {
            background: #1db954;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Player</h1>
            <p class="tagline">Your personal music collection</p>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>
        
        <div class="player-container">
            <div class="now-playing">
                <div class="album-art-container">
                    <div class="circular-progress" id="circular-progress"></div>
                    <div class="album-art">
                        <i class="fas fa-music"></i>
                    </div>
                </div>
                <p class="track-info">Select a song</p>
                <p class="artist">Unknown Artist</p>
                
                <div class="time-display">
                    <span id="current-time">0:00</span>
                    <span id="total-time">0:00</span>
                </div>
                
                <div class="progress-container">
                    <div class="progress">
                        <div class="progress-handle"></div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-shuffle" title="Shuffle">
                        <i class="fas fa-random"></i>
                    </button>
                    <button class="btn btn-previous" title="Previous">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="btn btn-play" title="Play">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="btn btn-next" title="Next">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="btn btn-repeat" title="Repeat">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
                
                <div class="playback-controls">
                    <div class="volume-container">
                        <i class="fas fa-volume-down"></i>
                        <input type="range" class="volume-slider" min="0" max="1" step="0.01" value="0.7">
                        <i class="fas fa-volume-up"></i>
                    </div>
                    
                    <button class="btn btn-speed" title="Playback Speed" id="speed-btn">
                        <i class="fas fa-cog"></i>
                    </button>
                    
                    <div class="speed-popup" id="speed-popup">
                        <button class="speed-option" data-speed="0.5">0.5x</button>
                        <button class="speed-option" data-speed="0.75">0.75x</button>
                        <button class="speed-option active" data-speed="1">1.0x (Normal)</button>
                        <button class="speed-option" data-speed="1.25">1.25x</button>
                        <button class="speed-option" data-speed="1.5">1.5x</button>
                        <button class="speed-option" data-speed="2">2.0x</button>
                    </div>
                </div>
            </div>
            
            <div class="playlist-section">
                <div class="playlist-header">
                    <h2>Your Playlist</h2>
                    <input type="text" class="search-box" placeholder="Search songs...">
                </div>
                <ul class="track-list">
                    <!-- Playlist items will be generated by JavaScript -->
                </ul>
            </div>
        </div>
        
        <footer>
            <p>Player &copy; 2025</p>
        </footer>
    </div>

    <div class="notification" id="notification">
        Song changed successfully
    </div>

    <script>
        // Your MP3 files list
        const mp3Files = [
            "16.mp3",
            "A Bar Song (Tipsy).mp3",
            "Am I Dreaming (Metro Boomin & A$AP Rocky, Roisee).mp3",
            "Backbone.mp3",
            "Baptize Me.mp3",
            "Broken Bones.mp3",
            "Call Out My Name.mp3",
            "Calm Down.mp3",
            "De la Vida Como Pelicula, Tragedia, Comedia y Ficcion.mp3",
            "Devil In Your Eye.mp3",
            "Energy.mp3",
            "Everybody.mp3",
            "Everyday (feat. Rod Stewart, Miguel & Mark Ronson).mp3",
            "Expectations.mp3",
            "Good News.mp3",
            "Hand Me Downs.mp3",
            "HEY CHILD.mp3",
            "Highway.mp3",
            "Hollow Crown.mp3",
            "HONEST.mp3",
            "HOLD YOU DOWN.mp3",
            "Hurt.mp3",
            "Hurt Feelings.mp3",
            "I Can't Go on Without You.mp3",
            "I Feel Like I'm Drowning.mp3",
            "I Was Never There.mp3",
            "I'm The Man.mp3",
            "Jet Fuel.mp3",
            "Kerosene Dreams.mp3",
            "Kingdom of One.mp3",
            "Ladders.mp3",
            "Lose Control.mp3",
            "Mafiana Será Otro Dia.mp3",
            "Nightshade.mp3",
            "No Time To Die.mp3",
            "Pain feat.OverDoz.).mp3",
            "Power is Power (feat. The Weeknd & Travis Scott).mp3",
            "Pray For Me.mp3",
            "Prophecy.mp3",
            "Shut up My Moms Calling.mp3",
            "Star Shopping.mp3",
            "Still (feat. 6LACK and Smino).mp3",
            "Stupid Love Story.mp3",
            "Take Me to Church.mp3",
            "The Ballad of Eddie Jabuley.mp3",
            "The Door.mp3",
            "Too Sweet.mp3",
            "Torches.mp3",
            "track-01.mp3",
            "Trust.mp3",
            "Turn on Me.mp3",
            "UNA BALA.mp3",
            "Weekend (feat. Miguel).mp3",
            "When I Lie (Remix) (feat. Ty Dolla $ign).mp3",
            "When It Rains It Pours.mp3",
            "WILDFLOWER.mp3",
            "Woods.mp3"
        ];

        // Function to extract title and artist from filename
        function getTrackInfo(filename) {
            // Remove .mp3 extension
            let name = filename.replace('.mp3', '');
            
            // Try to extract artist if present in parentheses
            let title = name;
            let artist = "Unknown Artist";
            
            // Check for featuring artists or other indicators
            if (name.includes('(feat.')) {
                const featIndex = name.indexOf('(feat.');
                title = name.substring(0, featIndex).trim();
                artist = name.substring(featIndex).replace('(feat.', '').replace(')', '').trim();
            } else if (name.includes('-')) {
                const parts = name.split('-');
                if (parts.length >= 2) {
                    artist = parts[0].trim();
                    title = parts[1].trim();
                }
            }
            
            return { title, artist };
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Create tracks array from MP3 files
            const tracks = mp3Files.map((file, index) => {
                const { title, artist } = getTrackInfo(file);
                return {
                    title,
                    artist,
                    file: file,
                    duration: "3:30" // Placeholder duration
                };
            });
            
            // Audio element
            const audio = new Audio();
            let currentTrackIndex = 0;
            let isPlaying = false;
            let isShuffled = false;
            let repeatMode = 0; // 0: no repeat, 1: repeat all, 2: repeat one
            let playbackSpeed = 1.0;
            
            // DOM Elements
            const playBtn = document.querySelector('.btn-play');
            const prevBtn = document.querySelector('.btn-previous');
            const nextBtn = document.querySelector('.btn-next');
            const shuffleBtn = document.querySelector('.btn-shuffle');
            const repeatBtn = document.querySelector('.btn-repeat');
            const speedBtn = document.getElementById('speed-btn');
            const speedPopup = document.getElementById('speed-popup');
            const speedOptions = document.querySelectorAll('.speed-option');
            const progressContainer = document.querySelector('.progress-container');
            const progress = document.querySelector('.progress');
            const circularProgress = document.getElementById('circular-progress');
            const currentTimeEl = document.getElementById('current-time');
            const totalTimeEl = document.getElementById('total-time');
            const currentTrackEl = document.querySelector('.track-info');
            const currentArtistEl = document.querySelector('.artist');
            const volumeSlider = document.querySelector('.volume-slider');
            const trackList = document.querySelector('.track-list');
            const searchBox = document.querySelector('.search-box');
            const themeToggle = document.getElementById('theme-toggle');
            const notification = document.getElementById('notification');
            
            // Initialize player
            function initPlayer() {
                // Create playlist
                renderPlaylist();
                
                // Load first track
                loadTrack(currentTrackIndex);
                
                // Event listeners
                playBtn.addEventListener('click', togglePlay);
                prevBtn.addEventListener('click', prevTrack);
                nextBtn.addEventListener('click', nextTrack);
                shuffleBtn.addEventListener('click', toggleShuffle);
                repeatBtn.addEventListener('click', toggleRepeat);
                speedBtn.addEventListener('click', toggleSpeedPopup);
                speedOptions.forEach(option => {
                    option.addEventListener('click', setPlaybackSpeed);
                });
                audio.addEventListener('timeupdate', updateProgress);
                audio.addEventListener('ended', handleTrackEnd);
                progressContainer.addEventListener('click', setProgress);
                volumeSlider.addEventListener('input', setVolume);
                searchBox.addEventListener('input', filterTracks);
                themeToggle.addEventListener('click', toggleTheme);
                
                // Close speed popup when clicking outside
                document.addEventListener('click', function(e) {
                    if (!speedPopup.contains(e.target) && e.target !== speedBtn) {
                        speedPopup.classList.remove('show');
                    }
                });
                
                // Add tooltips
                addTooltips();
            }
            
            // Add tooltips to buttons
            function addTooltips() {
                const buttons = document.querySelectorAll('.btn');
                buttons.forEach(btn => {
                    const title = btn.getAttribute('title');
                    if (title) {
                        btn.addEventListener('mouseenter', function(e) {
                            // Create tooltip
                            const tooltip = document.createElement('div');
                            tooltip.className = 'tooltip';
                            tooltip.textContent = title;
                            tooltip.style.position = 'absolute';
                            tooltip.style.background = 'rgba(0,0,0,0.8)';
                            tooltip.style.color = 'white';
                            tooltip.style.padding = '5px 10px';
                            tooltip.style.borrowRadius = '4px';
                            tooltip.style.fontSize = '12px';
                            tooltip.style.zIndex = '1000';
                            tooltip.style.bottom = '100%';
                            tooltip.style.left = '50%';
                            tooltip.style.transform = 'translateX(-50%)';
                            tooltip.style.marginBottom = '5px';
                            tooltip.style.whiteSpace = 'nowrap';
                            
                            btn.style.position = 'relative';
                            btn.appendChild(tooltip);
                            
                            setTimeout(() => {
                                if (btn.contains(tooltip)) {
                                    btn.removeChild(tooltip);
                                }
                            }, 2000);
                        });
                        
                        btn.addEventListener('mouseleave', function() {
                            const tooltip = btn.querySelector('.tooltip');
                            if (tooltip) {
                                btn.removeChild(tooltip);
                            }
                        });
                    }
                });
            }
            
            // Toggle speed popup
            function toggleSpeedPopup(e) {
                e.stopPropagation();
                speedPopup.classList.toggle('show');
            }
            
            // Set playback speed
            function setPlaybackSpeed(e) {
                playbackSpeed = parseFloat(e.target.dataset.speed);
                audio.playbackRate = playbackSpeed;
                
                // Update active state
                speedOptions.forEach(option => {
                    option.classList.remove('active');
                });
                e.target.classList.add('active');
                
                showNotification(`Playback speed: ${playbackSpeed}x`);
                speedPopup.classList.remove('show');
            }
            
            // Show notification
            function showNotification(message) {
                notification.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
            
            // Toggle theme
            function toggleTheme() {
                document.body.classList.toggle('light-theme');
                const icon = themeToggle.querySelector('i');
                
                if (document.body.classList.contains('light-theme')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                    themeToggle.setAttribute('title', 'Switch to dark mode');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                    themeToggle.setAttribute('title', 'Switch to light mode');
                }
            }
            
            // Toggle shuffle
            function toggleShuffle() {
                isShuffled = !isShuffled;
                shuffleBtn.classList.toggle('active', isShuffled);
                showNotification(isShuffled ? 'Shuffle enabled' : 'Shuffle disabled');
            }
            
            // Toggle repeat
            function toggleRepeat() {
                repeatMode = (repeatMode + 1) % 3;
                
                // Update button appearance
                repeatBtn.classList.remove('active');
                if (repeatMode === 1) {
                    repeatBtn.classList.add('active');
                    showNotification('Repeat all');
                } else if (repeatMode === 2) {
                    repeatBtn.classList.add('active');
                    showNotification('Repeat one');
                } else {
                    showNotification('Repeat disabled');
                }
            }
            
            // Handle track end based on repeat mode
            function handleTrackEnd() {
                if (repeatMode === 2) {
                    // Repeat one track
                    audio.currentTime = 0;
                    audio.play();
                } else {
                    // Go to next track
                    nextTrack();
                }
            }
            
            // Render playlist
            function renderPlaylist() {
                trackList.innerHTML = '';
                
                tracks.forEach((track, index) => {
                    const li = document.createElement('li');
                    li.classList.add('track-item');
                    if (index === currentTrackIndex) {
                        li.classList.add('active');
                    }
                    
                    li.innerHTML = `
                        <span class="track-number">${index + 1}</span>
                        <div class="track-details">
                            <span class="track-title">${track.title}</span>
                            <span class="track-artist">${track.artist}</span>
                        </div>
                        <span class="track-duration">${track.duration}</span>
                    `;
                    
                    li.addEventListener('click', () => {
                        currentTrackIndex = index;
                        loadTrack(currentTrackIndex);
                        playTrack();
                        highlightActiveTrack();
                    });
                    
                    trackList.appendChild(li);
                });
            }
            
            // Filter tracks based on search input
            function filterTracks() {
                const searchText = searchBox.value.toLowerCase();
                const items = document.querySelectorAll('.track-item');
                
                items.forEach((item, index) => {
                    const title = tracks[index].title.toLowerCase();
                    const artist = tracks[index].artist.toLowerCase();
                    
                    if (title.includes(searchText) || artist.includes(searchText)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }
            
            // Highlight active track
            function highlightActiveTrack() {
                const items = document.querySelectorAll('.track-item');
                items.forEach((item, index) => {
                    if (index === currentTrackIndex) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            }
            
            // Load track
            function loadTrack(index) {
                // Set the audio source to the MP3 file
                audio.src = tracks[index].file;
                audio.playbackRate = playbackSpeed;
                currentTrackEl.textContent = tracks[index].title;
                currentArtistEl.textContent = tracks[index].artist;
                highlightActiveTrack();
                
                // Show notification
                showNotification(`Now playing: ${tracks[index].title}`);
            }
            
            // Play track
            function playTrack() {
                audio.play();
                isPlaying = true;
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                playBtn.setAttribute('title', 'Pause');
                circularProgress.classList.add('playing');
            }
            
            // Pause track
            function pauseTrack() {
                audio.pause();
                isPlaying = false;
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                playBtn.setAttribute('title', 'Play');
                circularProgress.classList.remove('playing');
            }
            
            // Toggle play/pause
            function togglePlay() {
                if (isPlaying) {
                    pauseTrack();
                } else {
                    playTrack();
                }
            }
            
            // Previous track
            function prevTrack() {
                if (audio.currentTime > 3) {
                    // If more than 3 seconds into the song, restart it
                    audio.currentTime = 0;
                } else {
                    // Otherwise, go to previous track
                    currentTrackIndex--;
                    if (currentTrackIndex < 0) {
                        currentTrackIndex = tracks.length - 1;
                    }
                    loadTrack(currentTrackIndex);
                    playTrack();
                }
            }
            
            // Next track
            function nextTrack() {
                if (isShuffled) {
                    // Play a random track
                    const randomIndex = Math.floor(Math.random() * tracks.length);
                    currentTrackIndex = randomIndex;
                } else {
                    // Play the next track in sequence
                    currentTrackIndex++;
                    if (currentTrackIndex >= tracks.length) {
                        currentTrackIndex = 0;
                    }
                }
                
                loadTrack(currentTrackIndex);
                playTrack();
            }
            
            // Update progress bar
            function updateProgress() {
                const { currentTime, duration } = audio;
                const progressPercent = (currentTime / duration) * 100;
                progress.style.width = `${progressPercent}%`;
                
                // Update circular progress
                circularProgress.style.background = `conic-gradient(#1db954 ${progressPercent}%, transparent 0%)`;
                
                // Update time displays
                currentTimeEl.textContent = formatTime(currentTime);
                totalTimeEl.textContent = formatTime(duration);
            }
            
            // Set progress on click
            function setProgress(e) {
                const width = this.clientWidth;
                const clickX = e.offsetX;
                const duration = audio.duration;
                audio.currentTime = (clickX / width) * duration;
            }
            
            // Set volume
            function setVolume() {
                audio.volume = volumeSlider.value;
            }
            
            // Format time
            function formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                
                const minutes = Math.floor(seconds / 60);
                seconds = Math.floor(seconds % 60);
                return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            }
            
            // Initialize the player
            initPlayer();
        });
    </script>
</body>
</html>